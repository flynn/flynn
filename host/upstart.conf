description "Flynn layer 0"

#start on (started libvirt-bin and started networking)
respawn
respawn limit 1000 60

script
  IP_ADDR=$(/sbin/ifconfig eth0 | grep -oP 'inet addr:\S+' | cut -d: -f2)
  [ -r /etc/default/etcd-discovery ] && . /etc/default/etcd-discovery && export ETCD_DISCOVERY
  flynn-host daemon --manifest /etc/flynn/host-manifest.json --external $IP_ADDR --state /tmp/flynn-host-state.bolt
end script
